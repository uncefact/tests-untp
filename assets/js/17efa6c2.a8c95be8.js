"use strict";(self.webpackChunkdocumentation=self.webpackChunkdocumentation||[]).push([[7716],{18481:(e,n,i)=>{i.d(n,{Ay:()=>o,RM:()=>r});var t=i(74848),c=i(28453);const r=[];function s(e){const n={admonition:"admonition",p:"p",...(0,c.R)(),...e.components};return(0,t.jsx)(n.admonition,{type:"info",children:(0,t.jsx)(n.p,{children:"Please note that this content is under development and is not ready for implementation. This status message will be updated as content development progresses."})})}function o(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(s,{...e})}):s(e)}},5978:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>o,default:()=>u,frontMatter:()=>s,metadata:()=>l,toc:()=>d});var t=i(74848),c=i(28453),r=i(18481);const s={sidebar_position:12,title:"Service Account Authentication"},o=void 0,l={id:"reference-implementation/service-account-authentication",title:"Service Account Authentication",description:"Overview",source:"@site/docs/reference-implementation/service-account-authentication.md",sourceDirName:"reference-implementation",slug:"/reference-implementation/service-account-authentication",permalink:"/tests-untp/docs/next/reference-implementation/service-account-authentication",draft:!1,unlisted:!1,editUrl:"https://github.com/uncefact/tests-untp/tree/next/documentation/docs/reference-implementation/service-account-authentication.md",tags:[],version:"current",sidebarPosition:12,frontMatter:{sidebar_position:12,title:"Service Account Authentication"},sidebar:"tutorialSidebar",previous:{title:"VC Component Configuration",permalink:"/tests-untp/docs/next/reference-implementation/configuration/vc-component-config"},next:{title:"Components",permalink:"/tests-untp/docs/next/reference-implementation/components/"}},a={},d=[...r.RM,{value:"Overview",id:"overview",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Keycloak Configuration",id:"keycloak-configuration",level:2},{value:"Creating a Custom Service Account Client",id:"creating-a-custom-service-account-client",level:3},{value:"Obtaining an Access Token",id:"obtaining-an-access-token",level:2},{value:"Using cURL",id:"using-curl",level:3},{value:"Response",id:"response",level:3},{value:"Calling the API with a Bearer Token",id:"calling-the-api-with-a-bearer-token",level:2},{value:"Using cURL",id:"using-curl-1",level:3},{value:"Environment Variables",id:"environment-variables",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.Ay,{}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsx)(n.p,{children:"The Reference Implementation APIs support two authentication methods:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Session-based authentication"})," - For interactive users via the web UI (uses OAuth2 authorization code flow)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Service account authentication"})," - For automated integrations and machine-to-machine (M2M) access"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"This guide covers how to configure and use service account authentication for programmatic API access."}),"\n",(0,t.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Keycloak identity provider running and configured"}),"\n",(0,t.jsxs)(n.li,{children:["A service account client configured in Keycloak (see ",(0,t.jsx)(n.a,{href:"#keycloak-configuration",children:"Keycloak Configuration"}),")"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"keycloak-configuration",children:"Keycloak Configuration"}),"\n",(0,t.jsx)(n.p,{children:"The default Keycloak realm includes a pre-configured service account client:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Property"}),(0,t.jsx)(n.th,{children:"Value"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Client ID"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"ri-service-account"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Client Secret"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"service-account-secret"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Grant Type"}),(0,t.jsx)(n.td,{children:"Client Credentials"})]})]})]}),"\n",(0,t.jsxs)(n.admonition,{title:"Production Usage",type:"warning",children:[(0,t.jsx)(n.p,{children:"For production deployments, you should:"}),(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Change the default client secret to a secure, randomly generated value"}),"\n",(0,t.jsx)(n.li,{children:"Configure appropriate client scopes and role mappings"}),"\n"]})]}),"\n",(0,t.jsx)(n.h3,{id:"creating-a-custom-service-account-client",children:"Creating a Custom Service Account Client"}),"\n",(0,t.jsx)(n.p,{children:"To create a new service account client in Keycloak:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Navigate to your Keycloak Admin Console"}),"\n",(0,t.jsxs)(n.li,{children:["Select your realm (e.g., ",(0,t.jsx)(n.code,{children:"untp-reference-implementation"}),")"]}),"\n",(0,t.jsxs)(n.li,{children:["Go to ",(0,t.jsx)(n.strong,{children:"Clients"})," \u2192 ",(0,t.jsx)(n.strong,{children:"Create client"})]}),"\n",(0,t.jsxs)(n.li,{children:["Configure the client:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Client ID"}),": Your desired client ID (e.g., ",(0,t.jsx)(n.code,{children:"my-integration"}),")"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Client authentication"}),": ON"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Authorization"}),": OFF"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Authentication flow"}),': Check only "Service accounts roles"']}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Save the client and note the generated client secret from the ",(0,t.jsx)(n.strong,{children:"Credentials"})," tab"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"obtaining-an-access-token",children:"Obtaining an Access Token"}),"\n",(0,t.jsx)(n.p,{children:"Use the OAuth2 client credentials grant to obtain an access token from Keycloak."}),"\n",(0,t.jsx)(n.h3,{id:"using-curl",children:"Using cURL"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Set your configuration\nKEYCLOAK_URL="http://localhost:8080"\nREALM="untp-reference-implementation"\nCLIENT_ID="ri-service-account"\nCLIENT_SECRET="service-account-secret"\n\n# Request an access token\ncurl -X POST "${KEYCLOAK_URL}/realms/${REALM}/protocol/openid-connect/token" \\\n  -H "Content-Type: application/x-www-form-urlencoded" \\\n  -d "grant_type=client_credentials" \\\n  -d "client_id=${CLIENT_ID}" \\\n  -d "client_secret=${CLIENT_SECRET}"\n'})}),"\n",(0,t.jsx)(n.h3,{id:"response",children:"Response"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-json",children:'{\n  "access_token": "eyJhbGciOiJSUzI1NiIsInR5cCI...",\n  "expires_in": 300,\n  "refresh_expires_in": 0,\n  "token_type": "Bearer",\n  "not-before-policy": 0,\n  "scope": "profile email roles"\n}\n'})}),"\n",(0,t.jsx)(n.h2,{id:"calling-the-api-with-a-bearer-token",children:"Calling the API with a Bearer Token"}),"\n",(0,t.jsxs)(n.p,{children:["Once you have an access token, include it in the ",(0,t.jsx)(n.code,{children:"Authorization"})," header of your API requests."]}),"\n",(0,t.jsx)(n.h3,{id:"using-curl-1",children:"Using cURL"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'# Using the token obtained above\nACCESS_TOKEN="eyJhbGciOiJSUzI1NiIsInR5cCI..."\n\n# Call the credentials API\ncurl -X POST "http://localhost:3003/api/v1/credentials" \\\n  -H "Authorization: Bearer ${ACCESS_TOKEN}" \\\n  -H "Content-Type: application/json" \\\n  -d \'{}\'\n'})}),"\n",(0,t.jsx)(n.h2,{id:"environment-variables",children:"Environment Variables"}),"\n",(0,t.jsx)(n.p,{children:"Configure the following environment variables for service account support:"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Variable"}),(0,t.jsx)(n.th,{children:"Description"}),(0,t.jsx)(n.th,{children:"Default"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"AUTH_KEYCLOAK_ISSUER"})}),(0,t.jsx)(n.td,{children:"Keycloak realm issuer URL"}),(0,t.jsx)(n.td,{children:"Required"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"AUTH_KEYCLOAK_SERVICE_ACCOUNT_CLIENT_ID"})}),(0,t.jsx)(n.td,{children:"Service account client ID"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"ri-service-account"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"AUTH_KEYCLOAK_SERVICE_ACCOUNT_CLIENT_SECRET"})}),(0,t.jsx)(n.td,{children:"Service account client secret"}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"service-account-secret"})})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"AUTH_KEYCLOAK_SERVICE_ACCOUNT_AUDIENCE"})}),(0,t.jsx)(n.td,{children:"Expected token audience (optional)"}),(0,t.jsx)(n.td,{children:"-"})]})]})]})]})}function u(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},28453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>o});var t=i(96540);const c={},r=t.createContext(c);function s(e){const n=t.useContext(r);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:s(e.components),t.createElement(r.Provider,{value:n},e.children)}}}]);