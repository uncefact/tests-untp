#!/usr/bin/env node

/**
 * Generate Test File List
 *
 * This script scans the untp-tests directory for .test.js files and generates
 * a TypeScript file with the list of test files for the browser bundle to import.
 * This allows the browser bundle to automatically include all test files without
 * needing Node.js filesystem modules in the final bundle.
 */

const fs = require('fs');
const path = require('path');

// Get the untp-tests directory path
const testsDir = path.join(__dirname, '../untp-tests');
const generatedDir = path.join(__dirname, '../src/generated');
const outputFile = path.join(generatedDir, 'test-file-list.ts');

// Ensure generated directory exists
if (!fs.existsSync(generatedDir)) {
  fs.mkdirSync(generatedDir, { recursive: true });
}

try {
  // Read all files in the untp-tests directory
  const files = fs.readdirSync(testsDir);

  // Filter for .test.js files
  const testFiles = files.filter((file) => file.endsWith('.test.js'));

  // Generate the TypeScript content with static imports
  const content = `/**
 * Auto-generated Test File Imports
 *
 * This file is automatically generated by scripts/generate-test-list.js
 * Do not edit manually - it will be overwritten on build
 */

// Static imports that get bundled by esbuild
${testFiles.map((file) => `import '../../untp-tests/${file}';`).join('\n')}
`;

  // Write the generated file
  fs.writeFileSync(outputFile, content, 'utf8');

  console.log(`Generated test file list with ${testFiles.length} files:`);
  testFiles.forEach((file) => console.log(`  - ${file}`));
  console.log(`Written to: ${path.relative(process.cwd(), outputFile)}`);
} catch (error) {
  console.error('Error generating test file list:', error);
  process.exit(1);
}
